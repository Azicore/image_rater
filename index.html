<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>Image Rater</title>
<style>
* {

}
body {
	background: #111111;
	color: #f0f0f0;
}
#list {
	display: flex;
	flex-wrap: wrap;
	align-items: center;
	list-style-type: none;
}
#list img {
	margin-right: 8px;
}
</style>
<script>
window.addEventListener('DOMContentLoaded', function() {
	const elDirs = document.getElementById('directories');
	const elList = document.getElementById('list');

	const initialize = async () => {
		const dirs = await (await fetch('/dirs')).json();
		for (const dirId in dirs) {
			const subdirs = await (await fetch(`/dir/${dirId}`)).json();
			let subdirHtml = '';
			for (const subdirId in subdirs) {
				subdirHtml = `${subdirHtml}<li data-dir-id="${dirId}" data-subdir-id="${subdirId}">${subdirs[subdirId]}</li>`;
			}
			elDirs.insertAdjacentHTML('beforeend', `<li data-dir-id="${dirId}"><p>${dirs[dirId]}</p><ul>${subdirHtml}</ul></li>`);
		}
	};
	initialize();

	elDirs.addEventListener('click', async (e) => {
		const subdirId = e.target.getAttribute('data-subdir-id');
		if (!subdirId) return;
		const dirId = e.target.getAttribute('data-dir-id');
		const subdirName = e.target.innerText;
		const files = await (await fetch(`/dir/${dirId}/${subdirId}`)).json();
		console.dir(files);
		elList.innerHTML = '';
		for (const fileId in files) {
			const file = files[fileId];
			elList.insertAdjacentHTML('beforeend', `<li>
				<a href="/file/${dirId}/${subdirName}/${file.n}">
					<img loading="lazy" src="/thumb/${fileId}" width="${file.tw}" height="${file.th}" alt="${file.n}" title="${file.n}">
				</a>
			</li>`);
		}
	});
});

</script>
</head>
<body>
<ul id="directories"></ul>
<ul id="list"></ul>
</body>
</html>
